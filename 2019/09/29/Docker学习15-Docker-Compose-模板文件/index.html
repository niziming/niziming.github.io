<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/ironman-draw.png">
    <link rel="icon" href="/img/favicon.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <!--<script async defer src="https://buttons.github.io/buttons.js"></script>-->
    <title>
        ğŸ”¥
        
          Dockerå­¦ä¹ 15-Docker-Compose-æ¨¡æ¿æ–‡ä»¶ - åæ¸Š | Blog
        
    </title>

    <link rel="canonical" href="https://niziming.github.io/2019/09/29/Dockerå­¦ä¹ 15-Docker-Compose-æ¨¡æ¿æ–‡ä»¶/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/beantech.min.css">


    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/highlight.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    
<link rel="stylesheet" href="/css/font-awesome.min.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <!--<link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">-->


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <!--<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>-->
    <!--<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>-->
    <!--[endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 7.3.0"></head>
<!-- buttons JavaScript -->

<script src="/js/buttons.js"></script>


<script src="/js/html5shiv.js"></script>


<script src="/js/respond.min.js"></script>



<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header{
    
        background-image: url('/img/article_header/article_bg.jpg')
        /*post*/
    
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                            
                              <a class="tag" href="/tags/#Docker Compose" title="Docker Compose">Docker Compose</a>
                            
                        </div>
                        <h1>Dockerå­¦ä¹ 15-Docker-Compose-æ¨¡æ¿æ–‡ä»¶</h1>
                        <h2 class="subheading"></h2>
                        <span class="meta">
                            Posted by åæ¸Š on
                            2019-09-29
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>


    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">åæ¸Š</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <h1><span id="docker-compose-æ¨¡æ¿æ–‡ä»¶">Docker-Compose-æ¨¡æ¿æ–‡ä»¶</span></h1>
<p>æ¨¡æ¿æ–‡ä»¶æ˜¯ä½¿ç”¨ Compose çš„æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°çš„æŒ‡ä»¤å…³é”®å­—ä¹Ÿæ¯”è¾ƒå¤šã€‚ä½†å¤§å®¶ä¸ç”¨æ‹…å¿ƒï¼Œè¿™é‡Œé¢å¤§éƒ¨åˆ†æŒ‡ä»¤è·Ÿ docker run ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p>
<p>é»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶åç§°ä¸º docker-compose.ymlï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="params">services:</span></span><br><span class="line">  <span class="params">webapp:</span></span><br><span class="line">    <span class="params">image:</span> examples<span class="symbol">/web</span></span><br><span class="line">    <span class="params">ports:</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">    <span class="params">volumes:</span></span><br><span class="line">      <span class="operator">-</span> <span class="string">&quot;/data&quot;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡ image æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– build æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚</p>
<p>å¦‚æœä½¿ç”¨ build æŒ‡ä»¤ï¼Œåœ¨ Dockerfile ä¸­è®¾ç½®çš„é€‰é¡¹ (ä¾‹å¦‚ï¼šCMD, EXPOSE, VOLUME, ENV ç­‰) å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨ docker-compose.yml ä¸­å†æ¬¡è®¾ç½®ã€‚</p>
<p>ä¸‹é¢åˆ†åˆ«ä»‹ç»å„ä¸ªæŒ‡ä»¤çš„ç”¨æ³•ã€‚</p>
<p>#build<br>
æŒ‡å®š Dockerfile æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼ˆå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ï¼Œæˆ–è€…ç›¸å¯¹ docker-compose.yml æ–‡ä»¶çš„è·¯å¾„ï¼‰ã€‚ Compose å°†ä¼šåˆ©ç”¨å®ƒè‡ªåŠ¨æ„å»ºè¿™ä¸ªé•œåƒï¼Œç„¶åä½¿ç”¨è¿™ä¸ªé•œåƒã€‚</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  webapp:</span></span><br><span class="line"><span class="symbol">    build:</span> ./dir</span><br></pre></td></tr></table></figure>
<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ context æŒ‡ä»¤æŒ‡å®š Dockerfile æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚</p>
<p>ä½¿ç”¨ dockerfile æŒ‡ä»¤æŒ‡å®š Dockerfile æ–‡ä»¶åã€‚</p>
<p>ä½¿ç”¨ arg æŒ‡ä»¤æŒ‡å®šæ„å»ºé•œåƒæ—¶çš„å˜é‡ã€‚</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">  webapp:</span></span><br><span class="line"><span class="symbol">    build:</span></span><br><span class="line"><span class="symbol">      context:</span> ./dir</span><br><span class="line"><span class="symbol">      dockerfile:</span> Dockerfile-alternate</span><br><span class="line"><span class="symbol">      args:</span></span><br><span class="line"><span class="symbol">        buildno:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ cache_from æŒ‡å®šæ„å»ºé•œåƒçš„ç¼“å­˜</p>
<figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">build</span><span class="punctuation">:</span></span><br><span class="line">  <span class="attribute">context</span><span class="punctuation">:</span> <span class="string">.</span></span><br><span class="line">  <span class="attribute">cache_from</span><span class="punctuation">:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">alpine:latest</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">corp/web_app:3.14</span></span><br><span class="line"><span class="comment">#cap_add, cap_drop</span></span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šå®¹å™¨çš„å†…æ ¸èƒ½åŠ›ï¼ˆcapacityï¼‰åˆ†é…ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè®©å®¹å™¨æ‹¥æœ‰æ‰€æœ‰èƒ½åŠ›å¯ä»¥æŒ‡å®šä¸ºï¼š</p>
<p>cap_add:</p>
<ul>
<li>ALL<br>
å»æ‰ NET_ADMIN èƒ½åŠ›å¯ä»¥æŒ‡å®šä¸ºï¼š</li>
</ul>
<p>cap_drop:</p>
<ul>
<li>NET_ADMIN<br>
#command<br>
è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚</li>
</ul>
<p>command: echo â€œhello worldâ€<br>
#configs<br>
ä»…ç”¨äº Swarm mode</p>
<p>#cgroup_parent<br>
æŒ‡å®šçˆ¶ cgroup ç»„ï¼Œæ„å‘³ç€å°†ç»§æ‰¿è¯¥ç»„çš„èµ„æºé™åˆ¶ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåˆ›å»ºäº†ä¸€ä¸ª cgroup ç»„åç§°ä¸º cgroups_1ã€‚</p>
<p>cgroup_parent: cgroups_1<br>
#container_name<br>
æŒ‡å®šå®¹å™¨åç§°ã€‚é»˜è®¤å°†ä¼šä½¿ç”¨ é¡¹ç›®åç§°_æœåŠ¡åç§°_åºå· è¿™æ ·çš„æ ¼å¼ã€‚</p>
<p>container_name: docker-web-container<br>
æ³¨æ„ï¼šæŒ‡å®šå®¹å™¨åç§°åï¼Œè¯¥æœåŠ¡å°†æ— æ³•è¿›è¡Œæ‰©å±•ï¼ˆscaleï¼‰ï¼Œå› ä¸º Docker ä¸å…è®¸å¤šä¸ªå®¹å™¨å…·æœ‰ç›¸åŒçš„åç§°ã€‚</p>
<p>#deploy<br>
ä»…ç”¨äº Swarm mode</p>
<p>#devices<br>
æŒ‡å®šè®¾å¤‡æ˜ å°„å…³ç³»ã€‚</p>
<p>devices:</p>
<ul>
<li>â€œ/dev/ttyUSB1:/dev/ttyUSB0â€<br>
#depends_on<br>
è§£å†³å®¹å™¨çš„ä¾èµ–ã€å¯åŠ¨å…ˆåçš„é—®é¢˜ã€‚ä»¥ä¸‹ä¾‹å­ä¸­ä¼šå…ˆå¯åŠ¨ redis db å†å¯åŠ¨ web</li>
</ul>
<p>version: â€˜3â€™</p>
<p>services:<br>
web:<br>
build: .<br>
depends_on:<br>
- db<br>
- redis</p>
<p>redis:<br>
image: redis</p>
<p>db:<br>
image: postgres<br>
æ³¨æ„ï¼šweb æœåŠ¡ä¸ä¼šç­‰å¾… redis db ã€Œå®Œå…¨å¯åŠ¨ã€ä¹‹åæ‰å¯åŠ¨ã€‚</p>
<p>#dns<br>
è‡ªå®šä¹‰ DNS æœåŠ¡å™¨ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<p>dns: 8.8.8.8</p>
<p>dns:</p>
<ul>
<li>8.8.8.8</li>
<li>114.114.114.114<br>
#dns_search<br>
é…ç½® DNS æœç´¢åŸŸã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚</li>
</ul>
<p>dns_search: <a target="_blank" rel="noopener" href="http://example.com">example.com</a></p>
<p>dns_search:</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://domain1.example.com">domain1.example.com</a></li>
<li><a target="_blank" rel="noopener" href="http://domain2.example.com">domain2.example.com</a><br>
#tmpfs<br>
æŒ‚è½½ä¸€ä¸ª tmpfs æ–‡ä»¶ç³»ç»Ÿåˆ°å®¹å™¨ã€‚</li>
</ul>
<p>tmpfs: /run<br>
tmpfs:</p>
<ul>
<li>/run</li>
<li>/tmp<br>
#env_file<br>
ä»æ–‡ä»¶ä¸­è·å–ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºå•ç‹¬çš„æ–‡ä»¶è·¯å¾„æˆ–åˆ—è¡¨ã€‚</li>
</ul>
<p>å¦‚æœé€šè¿‡ docker-compose -f FILE æ–¹å¼æ¥æŒ‡å®š Compose æ¨¡æ¿æ–‡ä»¶ï¼Œåˆ™ env_file ä¸­å˜é‡çš„è·¯å¾„ä¼šåŸºäºæ¨¡æ¿æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å¦‚æœæœ‰å˜é‡åç§°ä¸ environment æŒ‡ä»¤å†²çªï¼Œåˆ™æŒ‰ç…§æƒ¯ä¾‹ï¼Œä»¥åè€…ä¸ºå‡†ã€‚</p>
<p>env_file: .env</p>
<p>env_file:</p>
<ul>
<li>./common.env</li>
<li>./apps/web.env</li>
<li>/opt/secrets.env<br>
ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­æ¯ä¸€è¡Œå¿…é¡»ç¬¦åˆæ ¼å¼ï¼Œæ”¯æŒ # å¼€å¤´çš„æ³¨é‡Šè¡Œã€‚</li>
</ul>
<h1><span id="commonenv-set-development-environment">common.env: Set development environment</span></h1>
<p>PROG_ENV=development<br>
#environment<br>
è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§æ ¼å¼ã€‚</p>
<p>åªç»™å®šåç§°çš„å˜é‡ä¼šè‡ªåŠ¨è·å–è¿è¡Œ Compose ä¸»æœºä¸Šå¯¹åº”å˜é‡çš„å€¼ï¼Œå¯ä»¥ç”¨æ¥é˜²æ­¢æ³„éœ²ä¸å¿…è¦çš„æ•°æ®ã€‚</p>
<p>environment:<br>
RACK_ENV: development<br>
SESSION_SECRET:</p>
<p>environment:</p>
<ul>
<li>RACK_ENV=development</li>
<li>SESSION_SECRET<br>
å¦‚æœå˜é‡åç§°æˆ–è€…å€¼ä¸­ç”¨åˆ° true|falseï¼Œyes|no ç­‰è¡¨è¾¾ å¸ƒå°” å«ä¹‰çš„è¯æ±‡ï¼Œæœ€å¥½æ”¾åˆ°å¼•å·é‡Œï¼Œé¿å… YAML è‡ªåŠ¨è§£ææŸäº›å†…å®¹ä¸ºå¯¹åº”çš„å¸ƒå°”è¯­ä¹‰ã€‚è¿™äº›ç‰¹å®šè¯æ±‡ï¼ŒåŒ…æ‹¬</li>
</ul>
<p>y|Y|yes|Yes|YES|n|N|no|No|NO|true|True|TRUE|false|False|FALSE|on|On|ON|off|Off|OFF<br>
#expose<br>
æš´éœ²ç«¯å£ï¼Œä½†ä¸æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œåªè¢«è¿æ¥çš„æœåŠ¡è®¿é—®ã€‚</p>
<p>ä»…å¯ä»¥æŒ‡å®šå†…éƒ¨ç«¯å£ä¸ºå‚æ•°</p>
<p>expose:</p>
<ul>
<li>â€œ3000â€</li>
<li>â€œ8000â€<br>
#external_links<br>
æ³¨æ„ï¼šä¸å»ºè®®ä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚</li>
</ul>
<p>é“¾æ¥åˆ° docker-compose.yml å¤–éƒ¨çš„å®¹å™¨ï¼Œç”šè‡³å¹¶é Compose ç®¡ç†çš„å¤–éƒ¨å®¹å™¨ã€‚</p>
<p>external_links:</p>
<ul>
<li>redis_1</li>
<li>project_db_1:mysql</li>
<li>project_db_1:postgresql<br>
#extra_hosts<br>
ç±»ä¼¼ Docker ä¸­çš„ --add-host å‚æ•°ï¼ŒæŒ‡å®šé¢å¤–çš„ host åç§°æ˜ å°„ä¿¡æ¯ã€‚</li>
</ul>
<p>extra_hosts:</p>
<ul>
<li>â€œgoogledns:8.8.8.8â€</li>
<li>&quot;dockerhub:52.1.157.61&quot;<br>
ä¼šåœ¨å¯åŠ¨åçš„æœåŠ¡å®¹å™¨ä¸­ /etc/hosts æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä¸¤æ¡æ¡ç›®ã€‚</li>
</ul>
<p>8.8.8.8 googledns<br>
52.1.157.61 dockerhub<br>
#healthcheck<br>
é€šè¿‡å‘½ä»¤æ£€æŸ¥å®¹å™¨æ˜¯å¦å¥åº·è¿è¡Œã€‚</p>
<p>healthcheck:<br>
test: [â€œCMDâ€, â€œcurlâ€, â€œ-fâ€, â€œ<a target="_blank" rel="noopener" href="http://localhost">http://localhost</a>â€]<br>
interval: 1m30s<br>
timeout: 10s<br>
retries: 3<br>
#image<br>
æŒ‡å®šä¸ºé•œåƒåç§°æˆ–é•œåƒ IDã€‚å¦‚æœé•œåƒåœ¨æœ¬åœ°ä¸å­˜åœ¨ï¼ŒCompose å°†ä¼šå°è¯•æ‹‰å–è¿™ä¸ªé•œåƒã€‚</p>
<p>image: ubuntu<br>
image: orchardup/postgresql<br>
image: a4bc65fd<br>
#labels<br>
ä¸ºå®¹å™¨æ·»åŠ  Docker å…ƒæ•°æ®ï¼ˆmetadataï¼‰ä¿¡æ¯ã€‚ä¾‹å¦‚å¯ä»¥ä¸ºå®¹å™¨æ·»åŠ è¾…åŠ©è¯´æ˜ä¿¡æ¯ã€‚</p>
<p>labels:<br>
com.startupteam.description: &quot;webapp for a startup team&quot;<br>
com.startupteam.department: &quot;devops department&quot;<br>
com.startupteam.release: â€œrc3 for v1.0â€<br>
#links<br>
æ³¨æ„ï¼šä¸æ¨èä½¿ç”¨è¯¥æŒ‡ä»¤ã€‚</p>
<p>#logging<br>
é…ç½®æ—¥å¿—é€‰é¡¹ã€‚</p>
<p>logging:<br>
driver: syslog<br>
options:<br>
syslog-address: &quot;tcp://192.168.0.42:123&quot;<br>
ç›®å‰æ”¯æŒä¸‰ç§æ—¥å¿—é©±åŠ¨ç±»å‹ã€‚</p>
<p>driver: &quot;json-file&quot;<br>
driver: &quot;syslog&quot;<br>
driver: &quot;none&quot;<br>
options é…ç½®æ—¥å¿—é©±åŠ¨çš„ç›¸å…³å‚æ•°ã€‚</p>
<p>options:<br>
max-size: &quot;200k&quot;<br>
max-file: â€œ10â€<br>
#network_mode<br>
è®¾ç½®ç½‘ç»œæ¨¡å¼ã€‚ä½¿ç”¨å’Œ docker run çš„ --network å‚æ•°ä¸€æ ·çš„å€¼ã€‚</p>
<p>network_mode: &quot;bridge&quot;<br>
network_mode: &quot;host&quot;<br>
network_mode: &quot;none&quot;<br>
network_mode: &quot;service:[service name]&quot;<br>
network_mode: â€œcontainer:[container name/id]â€<br>
#networks<br>
é…ç½®å®¹å™¨è¿æ¥çš„ç½‘ç»œã€‚</p>
<p>version: &quot;3&quot;<br>
services:</p>
<p>some-service:<br>
networks:<br>
- some-network<br>
- other-network</p>
<p>networks:<br>
some-network:<br>
other-network:<br>
#pid<br>
è·Ÿä¸»æœºç³»ç»Ÿå…±äº«è¿›ç¨‹å‘½åç©ºé—´ã€‚æ‰“å¼€è¯¥é€‰é¡¹çš„å®¹å™¨ä¹‹é—´ï¼Œä»¥åŠå®¹å™¨å’Œå®¿ä¸»æœºç³»ç»Ÿä¹‹é—´å¯ä»¥é€šè¿‡è¿›ç¨‹ ID æ¥ç›¸äº’è®¿é—®å’Œæ“ä½œã€‚</p>
<p>pid: â€œhostâ€<br>
#ports<br>
æš´éœ²ç«¯å£ä¿¡æ¯ã€‚</p>
<p>ä½¿ç”¨å®¿ä¸»ç«¯å£ï¼šå®¹å™¨ç«¯å£ (HOST:CONTAINER) æ ¼å¼ï¼Œæˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚</p>
<p>ports:</p>
<ul>
<li>â€œ3000â€</li>
<li>â€œ8000:8000â€</li>
<li>â€œ49100:22â€</li>
<li>&quot;127.0.0.1:8001:8001&quot;<br>
æ³¨æ„ï¼šå½“ä½¿ç”¨ HOST:CONTAINER æ ¼å¼æ¥æ˜ å°„ç«¯å£æ—¶ï¼Œå¦‚æœä½ ä½¿ç”¨çš„å®¹å™¨ç«¯å£å°äº 60 å¹¶ä¸”æ²¡æ”¾åˆ°å¼•å·é‡Œï¼Œå¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ç»“æœï¼Œå› ä¸º YAML ä¼šè‡ªåŠ¨è§£æ xx:yy è¿™ç§æ•°å­—æ ¼å¼ä¸º 60 è¿›åˆ¶ã€‚ä¸ºé¿å…å‡ºç°è¿™ç§é—®é¢˜ï¼Œå»ºè®®æ•°å­—ä¸²éƒ½é‡‡ç”¨å¼•å·åŒ…æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</li>
</ul>
<p>#secrets<br>
å­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚ mysql æœåŠ¡å¯†ç ã€‚</p>
<p>version: &quot;3.1&quot;<br>
services:</p>
<p>mysql:<br>
image: mysql<br>
environment:<br>
MYSQL_ROOT_PASSWORD_FILE: /run/secrets/db_root_password<br>
secrets:<br>
- db_root_password<br>
- my_other_secret</p>
<p>secrets:<br>
my_secret:<br>
file: ./my_secret.txt<br>
my_other_secret:<br>
external: true<br>
#security_opt<br>
æŒ‡å®šå®¹å™¨æ¨¡æ¿æ ‡ç­¾ï¼ˆlabelï¼‰æœºåˆ¶çš„é»˜è®¤å±æ€§ï¼ˆç”¨æˆ·ã€è§’è‰²ã€ç±»å‹ã€çº§åˆ«ç­‰ï¼‰ã€‚ä¾‹å¦‚é…ç½®æ ‡ç­¾çš„ç”¨æˆ·åå’Œè§’è‰²åã€‚</p>
<p>security_opt:<br>
- label:user:USER<br>
- label:role:ROLE<br>
#stop_signal<br>
è®¾ç½®å¦ä¸€ä¸ªä¿¡å·æ¥åœæ­¢å®¹å™¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨çš„æ˜¯ SIGTERM åœæ­¢å®¹å™¨ã€‚</p>
<p>stop_signal: SIGUSR1<br>
#sysctls<br>
é…ç½®å®¹å™¨å†…æ ¸å‚æ•°ã€‚</p>
<p>sysctls:<br>
net.core.somaxconn: 1024<br>
net.ipv4.tcp_syncookies: 0</p>
<p>sysctls:</p>
<ul>
<li>net.core.somaxconn=1024</li>
<li>net.ipv4.tcp_syncookies=0<br>
#ulimits<br>
æŒ‡å®šå®¹å™¨çš„ ulimits é™åˆ¶å€¼ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼ŒæŒ‡å®šæœ€å¤§è¿›ç¨‹æ•°ä¸º 65535ï¼ŒæŒ‡å®šæ–‡ä»¶å¥æŸ„æ•°ä¸º 20000ï¼ˆè½¯é™åˆ¶ï¼Œåº”ç”¨å¯ä»¥éšæ—¶ä¿®æ”¹ï¼Œä¸èƒ½è¶…è¿‡ç¡¬é™åˆ¶ï¼‰ å’Œ 40000ï¼ˆç³»ç»Ÿç¡¬é™åˆ¶ï¼Œåªèƒ½ root ç”¨æˆ·æé«˜ï¼‰ã€‚</p>
<p>ulimits:<br>
nproc: 65535<br>
nofile:<br>
soft: 20000<br>
hard: 40000<br>
#volumes<br>
æ•°æ®å·æ‰€æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚å¯ä»¥è®¾ç½®å®¿ä¸»æœºè·¯å¾„ ï¼ˆHOST:CONTAINERï¼‰ æˆ–åŠ ä¸Šè®¿é—®æ¨¡å¼ ï¼ˆHOST:CONTAINER:roï¼‰ã€‚</p>
<p>è¯¥æŒ‡ä»¤ä¸­è·¯å¾„æ”¯æŒç›¸å¯¹è·¯å¾„ã€‚</p>
<p>volumes:</p>
<ul>
<li>/var/lib/mysql</li>
<li>cache/:/tmp/cache</li>
<li>~/configs:/etc/configs/:ro<br>
#å…¶å®ƒæŒ‡ä»¤<br>
æ­¤å¤–ï¼Œè¿˜æœ‰åŒ…æ‹¬ domainname, entrypoint, hostname, ipc, mac_address, privileged, read_only, shm_size, restart, stdin_open, tty, user, working_dir ç­‰æŒ‡ä»¤ï¼ŒåŸºæœ¬è·Ÿ docker run ä¸­å¯¹åº”å‚æ•°çš„åŠŸèƒ½ä¸€è‡´ã€‚</li>
</ul>
<p>æŒ‡å®šæœåŠ¡å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å…¥å£æ–‡ä»¶ã€‚</p>
<p>entrypoint: /code/entrypoint.sh<br>
æŒ‡å®šå®¹å™¨ä¸­è¿è¡Œåº”ç”¨çš„ç”¨æˆ·åã€‚</p>
<p>user: nginx<br>
æŒ‡å®šå®¹å™¨ä¸­å·¥ä½œç›®å½•ã€‚</p>
<p>working_dir: /code<br>
æŒ‡å®šå®¹å™¨ä¸­æœç´¢åŸŸåã€ä¸»æœºåã€mac åœ°å€ç­‰ã€‚</p>
<p>domainname: your_website.com<br>
hostname: test<br>
mac_address: 08-00-27-00-0C-0A<br>
å…è®¸å®¹å™¨ä¸­è¿è¡Œä¸€äº›ç‰¹æƒå‘½ä»¤ã€‚</p>
<p>privileged: true<br>
æŒ‡å®šå®¹å™¨é€€å‡ºåçš„é‡å¯ç­–ç•¥ä¸ºå§‹ç»ˆé‡å¯ã€‚è¯¥å‘½ä»¤å¯¹ä¿æŒæœåŠ¡å§‹ç»ˆè¿è¡Œååˆ†æœ‰æ•ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ¨èé…ç½®ä¸º always æˆ–è€… unless-stoppedã€‚</p>
<p>restart: always<br>
ä»¥åªè¯»æ¨¡å¼æŒ‚è½½å®¹å™¨çš„ root æ–‡ä»¶ç³»ç»Ÿï¼Œæ„å‘³ç€ä¸èƒ½å¯¹å®¹å™¨å†…å®¹è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>read_only: true<br>
æ‰“å¼€æ ‡å‡†è¾“å…¥ï¼Œå¯ä»¥æ¥å—å¤–éƒ¨è¾“å…¥ã€‚</p>
<p>stdin_open: true<br>
æ¨¡æ‹Ÿä¸€ä¸ªä¼ªç»ˆç«¯ã€‚</p>
<p>tty: true<br>
#è¯»å–å˜é‡<br>
Compose æ¨¡æ¿æ–‡ä»¶æ”¯æŒåŠ¨æ€è¯»å–ä¸»æœºçš„ç³»ç»Ÿç¯å¢ƒå˜é‡å’Œå½“å‰ç›®å½•ä¸‹çš„ .env æ–‡ä»¶ä¸­çš„å˜é‡ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä¸‹é¢çš„ Compose æ–‡ä»¶å°†ä»è¿è¡Œå®ƒçš„ç¯å¢ƒä¸­è¯»å–å˜é‡ ${MONGO_VERSION} çš„å€¼ï¼Œå¹¶å†™å…¥æ‰§è¡Œçš„æŒ‡ä»¤ä¸­ã€‚</p>
<p>version: &quot;3&quot;<br>
services:</p>
<p>db:<br>
image: &quot;mongo:${MONGO_VERSION}&quot;<br>
å¦‚æœæ‰§è¡Œ MONGO_VERSION=3.2 docker-compose up åˆ™ä¼šå¯åŠ¨ä¸€ä¸ª mongo:3.2 é•œåƒçš„å®¹å™¨ï¼›å¦‚æœæ‰§è¡Œ MONGO_VERSION=2.8 docker-compose up åˆ™ä¼šå¯åŠ¨ä¸€ä¸ª mongo:2.8 é•œåƒçš„å®¹å™¨ã€‚</p>
<p>è‹¥å½“å‰ç›®å½•å­˜åœ¨ .env æ–‡ä»¶ï¼Œæ‰§è¡Œ docker-compose å‘½ä»¤æ—¶å°†ä»è¯¥æ–‡ä»¶ä¸­è¯»å–å˜é‡ã€‚</p>
<p>åœ¨å½“å‰ç›®å½•æ–°å»º .env æ–‡ä»¶å¹¶å†™å…¥ä»¥ä¸‹å†…å®¹ã€‚</p>
<h1><span id="æ”¯æŒ-å·æ³¨é‡Š">æ”¯æŒ # å·æ³¨é‡Š</span></h1>
<p>MONGO_VERSION=3.6<br>
æ‰§è¡Œ docker-compose up åˆ™ä¼šå¯åŠ¨ä¸€ä¸ª mongo:3.6 é•œåƒçš„å®¹å™¨ã€‚</p>


                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/2019/09/29/Dockerå­¦ä¹ 16-Docker-Compose-å‘½ä»¤è¯´æ˜/" data-toggle="tooltip" data-placement="top" title="Dockerå­¦ä¹ 16-Docker-Composeå‘½ä»¤è¯´æ˜">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/2019/09/29/Dockerå­¦ä¹ 14-Docker-Compose-çš„ä½¿ç”¨/" data-toggle="tooltip" data-placement="top" title="Dockerå­¦ä¹ 14-Docker-Compose-çš„ä½¿ç”¨">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!-- duoshuo Share start -->
                
                <!-- å¤šè¯´ Share end-->

                <!-- å¤šè¯´è¯„è®ºæ¡† start -->
                
                <!-- å¤šè¯´è¯„è®ºæ¡† end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->
            </div>

            <!-- Tabe of Content -->
            <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">Docker-Compose-æ¨¡æ¿æ–‡ä»¶</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">common.env: Set development environment</span></a></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">æ”¯æŒ # å·æ³¨é‡Š</span></a></li></ol>
        
        </div>
      </aside>
    


            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#Docker" title="Docker">Docker</a>
                        
                          <a class="tag" href="/tags/#Docker Compose" title="Docker Compose">Docker Compose</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://www.douban.com/people/80901919/" target="_blank">è±†ç“£ åæ¸Š</a></li>
                    
                        <li><a href="https://github.com/niziming" target="_blank">GitHub niziming</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>







<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("/js/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'â„¬'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com//localhost/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; åæ¸Š 2025
                    <br>
                    Theme by <a target="_blank" rel="noopener" href="http://huangxuan.me">Hux</a>
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span>
                    re-Ported by <a target="_blank" rel="noopener" href="http://beantech.org">BeanTech</a> |
                    <!--<iframe-->
                        <!--style="margin-left: 2px; margin-bottom:-5px;"-->
                        <!--frameborder="0" scrolling="0" width="91px" height="20px"-->
                        <!--src="https://ghbtns.com/github-btn.html?user=YenYuHsuan&repo=hexo-theme-beantech&type=star&count=true" >-->
                    <!--</iframe>-->
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=niziming&amp;repo=hexo-blog&amp;type=star&amp;count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->

<script src="/js/jquery.min.js"></script>


<!-- Bootstrap Core JavaScript -->

<script src="/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->

<script src="/js/hux-blog.min.js"></script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document,
          t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!--
     Because of the native support for backtick-style fenced code blocks
     right within the Markdown is landed in Github Pages,
     From V1.6, There is no need for Highlight.js,
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("/js/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'https://niziming.github.io/';
    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script', '/js/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
